'use client'; 

import Link from 'next/link';
import { useSession, signOut } from 'next-auth/react';
import { useState, useEffect, useRef, FormEvent } from 'react';
import { Bars3Icon, XMarkIcon, MagnifyingGlassIcon, XCircleIcon,  } from '@heroicons/react/24/outline';
import { useRouter, useSearchParams, usePathname } from 'next/navigation';
import { FingerPrintIcon, CalendarDateRangeIcon, HomeIcon, UserCircleIcon} from '@heroicons/react/24/solid';

export default function Header() {
    const { data: session, status } = useSession();
    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
    const headerRef = useRef<HTMLElement>(null); 
    const [scrollingUp, setScrollingUp] = useState(true); 
    const lastScrollY = useRef(0); 

    const pathname = usePathname();

    const router = useRouter();
    const searchParams = useSearchParams(); 
    const initialSearchQuery = searchParams.get('query') || '';
    const [searchQuery, setSearchQuery] = useState(initialSearchQuery);

    const handleSignOut = async () => {
        await signOut({ callbackUrl: '/events' }); 
    };

    useEffect(() => {
        const handleScroll = () => {
            const currentScrollY = window.scrollY;

            if (currentScrollY < lastScrollY.current) {
                setScrollingUp(true);
            } else if (currentScrollY > lastScrollY.current && currentScrollY > 80) { 
                setScrollingUp(false);
            }
            lastScrollY.current = currentScrollY;
        };

        window.addEventListener('scroll', handleScroll);

        return () => {
            window.removeEventListener('scroll', handleScroll);
        };
    }, []); // Empty dependency array means this effect runs once on mount

    // Update search query state if URL search param changes (e.g., from external navigation)
    useEffect(() => {
        setSearchQuery(searchParams.get('query') || ''); 
    }, [searchParams]);

    const handleSearchSubmit = (e: FormEvent) => {
        e.preventDefault();
        if (searchQuery.trim()) {
        router.push(`/events?query=${encodeURIComponent(searchQuery.trim())}`);
        setIsMobileMenuOpen(false);
        } else {
        router.push('/events'); 
        }
    };

    const handleClearSearch = () => {
        setSearchQuery('');
        router.push('/events'); 
        setIsMobileMenuOpen(false);
    };

    return (
        <header
            ref={headerRef} // Attach the ref to the header
            className={`fixed top-0 z-10000 w-full bg-[#f5f5dc] dark:bg-[#222222] text-gray-800 dark:text-gray-400 shadow-lg transition-transform duration-500 py-1 px-[5%] flex flex-row justify-between items-center ${
                scrollingUp ? 'translate-y-0 opacity-100' : '-translate-y-full opacity-0'
            }`}
            >
            <Link href="/" title="eventribe, plus proches des événements à venir">
                <svg width="100" height="72" viewBox="0 0 1334 811" className='group' xmlns="http://www.w3.org/2000/svg">
              <path fill="#ff952a" d="m 821.5,798.60118 c -14.11531,-4.46409 -23.27569,-14.02989 -28.25314,-29.50356 -2.18594,-6.79555 -2.3905,-8.81165 -1.93771,-19.09762 0.60401,-13.72105 2.75165,-24.33482 10.25513,-50.68149 C 808.08779,676.4128 811.597,659.98459 812.52636,648 c 1.69021,-21.79619 -6.03624,-42.47453 -18.8249,-50.38115 -4.16874,-2.57733 -5.7247,-2.94986 -12.48193,-2.98845 -12.23388,-0.0698 -23.63991,5.13499 -35.43898,16.17164 -9.39261,8.78569 -14.33582,18.89338 -23.81595,48.69796 -2.27424,7.15 -5.55386,15.7 -7.28804,19 -3.72171,7.08209 -11.5614,15.29481 -17.17656,17.99383 -4.90003,2.35528 -16.89962,3.18945 -21.94197,1.52532 -11.63549,-3.84006 -16.55233,-17.00296 -11.66138,-31.21875 3.30328,-9.60115 7.29229,-15.05494 26.77334,-36.60464 19.04526,-21.06762 24.06588,-30.95924 23.11365,-45.53846 C 712.58365,566.28467 699.38532,557.60641 680,562.44367 c -22.00026,5.48976 -40.27156,17.06643 -63.39782,40.16875 -11.82236,11.81012 -18.94834,20.27587 -36.10026,42.88758 -25.40894,33.49709 -37.20717,46.97219 -50.10601,57.22752 -19.13065,15.20998 -36.00425,22.40503 -52.89562,22.55515 -9.68812,0.0861 -16.72134,-1.47656 -26.00029,-5.77682 -9.50211,-4.40368 -14.74629,-9.22941 -18.65262,-17.16429 -8.07592,-16.40454 -2.70333,-36.29989 14.48652,-53.64525 C 462.16598,633.73004 479.3315,623.72939 530,600.53494 567.80369,583.2296 581.65563,575.18221 599.15033,560.36152 614.99891,546.93535 621,538.11959 621,528.26382 c 0,-9.0206 -4.50451,-15.17467 -15.5,-21.17614 l -4,-2.18325 4,0.51428 c 21.35837,2.74601 58.35443,6.37444 89.5,8.77781 22.69705,1.75143 114.57463,1.74796 134,-0.005 78.38089,-7.0734 133.63184,-22.35568 171.0422,-47.30986 10.8206,-7.2178 22.6874,-18.6397 28.4394,-27.37323 23.2245,-35.26316 4.7259,-74.24907 -48.87316,-103.00071 -34.05519,-18.26789 -85.50507,-31.98617 -144.10844,-38.4242 -30.01501,-3.29737 -58.8773,-4.37202 -102.58155,-3.8195 -44.21658,0.559 -73.34645,2.50369 -117.41845,7.83878 -13.75,1.66449 -27.475,3.26879 -30.5,3.56512 -10.00374,0.97996 -40.98012,-4.45914 -46.68549,-8.19744 -8.79167,-5.76052 6.24629,-8.79938 56.68549,-11.45496 37.18838,-1.95794 48.08695,-3.74053 46.59764,-7.62161 -2.00477,-5.22435 -12.11861,-17.87759 -26.61126,-33.29284 -21.78487,-23.1717 -26.62543,-29.13953 -30.85276,-38.03773 -6.59149,-13.87458 -4.83792,-24.69923 4.86638,-30.03974 15.62805,-8.6005 37.34035,5.20194 58.95335,37.47646 12.99886,19.41108 20.41832,28.74093 30.27748,38.07345 C 691.64994,265.27576 706.45303,273 717.3772,273 c 5.50943,0 12.51797,-3.6143 15.39127,-7.93726 2.14227,-3.22312 2.26738,-4.29197 2.00807,-17.15608 -0.26855,-13.32244 -0.20649,-13.79376 2.14777,-16.31274 3.15736,-3.37825 5.88918,-3.2751 10.67565,0.4031 2.14502,1.64835 5.92504,4.56244 8.40004,6.47575 7.48089,5.78311 13.85561,4.21273 18.65907,-4.59659 1.59948,-2.93337 1.83033,-5.67145 1.76015,-20.87618 -0.0971,-21.02757 -1.20569,-27.99777 -9.98733,-62.79279 -9.62514,-38.13723 -9.89906,-39.85058 -9.86512,-61.70721 0.034,-21.920819 1.55134,-29.789385 8.54345,-44.305389 8.83879,-18.34984 27.33317,-29.569718 46.00319,-27.908505 19.70033,1.752887 32.83663,20.129023 35.89573,50.213894 1.58165,15.554773 0.0282,30.061194 -7.0142,65.5 -7.66181,38.55575 -8.30019,43.91074 -7.74889,65 0.50189,19.19912 1.87709,26.32643 6.55087,33.95138 4.41124,7.19662 12.56488,10.75943 20.19256,8.82332 5.32137,-1.35071 9.86662,-6.53703 15.42049,-17.59544 7.33184,-14.59857 11.69365,-18.07564 16.56459,-13.2047 2.50325,2.50325 2.81003,4.09736 3.37274,17.52544 0.4906,11.70737 2.19587,17.64996 5.58531,19.46393 4.01689,2.14978 9.36345,1.17324 16.58326,-3.02889 16.27816,-9.47433 23.45462,-20.51631 35.69843,-54.92698 8.22748,-23.12292 12.25046,-31.69032 18.60538,-39.6223 5.15092,-6.42918 15.10802,-13.7161 20.96479,-15.3427 6.6011,-1.83331 15.42693,-1.28977 20.30823,1.25069 6.6222,3.44652 9.1726,8.96812 8.6402,18.70625 -0.7354,13.45285 -6.3988,22.05626 -32.20443,48.92256 -14.43458,15.02789 -16.50689,17.73154 -21.32512,27.82188 -3.50721,7.3448 -3.70335,8.2852 -3.70335,17.75556 0,9.01884 0.2602,10.44258 2.65194,14.51075 7.30733,12.4292 24.62905,12.70764 45.10856,0.72509 5.1187,-2.99494 11.5132,-8.48364 21.8278,-18.73584 16.9612,-16.85843 28.2253,-30.74696 47.4457,-58.5 23.3547,-33.72278 33.2211,-46.36753 48.489,-62.1435 28.2509,-29.191062 55.0359,-41.840522 79.0905,-37.35122 12.4366,2.321045 25.7157,11.908822 30.1379,21.76016 3.4268,7.63372 2.9757,19.45003 -1.1429,29.94312 -5.6447,14.38128 -16.9026,29.39921 -29.039,38.73797 -7.3392,5.64741 -18.965,12.6458 -44.0695,26.52871 -52.4088,28.98229 -70.8196,41.56578 -89.4351,61.1275 -15.8467,16.65215 -23.606,31.76931 -22.1503,43.15481 0.8389,6.56109 6.0544,14.53988 12.1387,18.56996 10.2931,6.81789 22.2261,6.67098 58.4467,-0.71956 13.475,-2.74947 28.1,-5.28759 32.5,-5.64025 18.5232,-1.48467 36.8585,7.07487 39.0936,18.25017 0.5127,2.5636 0.01,3.71576 -3.1511,7.21413 -4.8144,5.32895 -14.3094,9.87045 -41.1353,19.67531 -33.1651,12.12179 -45.3233,18.44068 -56.9341,29.58993 -7.9606,7.64417 -10.7452,13.69806 -10.7187,23.30276 0.034,12.27833 5.502,23.55146 18.7586,38.67368 24.5565,28.01247 70.1372,60.35744 142.087,100.82771 21.9027,12.31982 29.3921,17.31381 37.0653,24.71534 18.2541,17.60796 19.0778,33.91838 2.134,42.25976 -12.0831,5.94849 -25.1378,5.91017 -43.345,-0.12723 -16.4641,-5.4594 -28.9329,-13.82217 -60.8543,-40.81466 -34.0032,-28.75283 -66.5047,-44.2829 -103.8662,-49.62983 -20.8356,-2.98187 -36.2088,0.50417 -45.9476,10.41914 -8.7067,8.86426 -11.5894,21.52375 -8.2842,36.38033 5.018,22.55473 18.8107,39.21721 56.1193,67.79576 10.4112,7.975 21.9966,17.38451 25.7453,20.91002 21.5703,20.28596 29.6861,41.082 23.654,60.61168 -4.7893,15.50605 -22.4293,24.94587 -41.8938,22.41893 -11.6692,-1.51493 -24.1203,-8.13733 -34.5883,-18.39654 -13.525,-13.25514 -20.3298,-25.42505 -31.9487,-57.13772 -12.663,-34.56266 -19.04984,-47.20105 -30.57737,-60.50745 -13.17817,-15.21176 -31.8228,-24.15432 -43.69493,-20.95749 -6.12415,1.64907 -10.22405,6.33696 -13.59454,15.54425 -5.01126,13.68942 -9.54688,15.59474 -20.40976,8.57372 -10.36272,-6.69775 -19.95127,-8.64835 -29.49053,-5.99927 -4.68752,1.30173 -10.2403,6.07403 -12.7177,10.93013 -6.18185,12.11743 -6.63136,41.17121 -1.03674,67.00974 12.97824,59.93955 13.59915,68.64257 6.04844,84.77806 -5.14401,10.99252 -16.90467,20.3433 -29.13133,23.16205 -5.94463,1.37048 -16.50967,1.20304 -21.38534,-0.33893 z M 260.27215,609.56314 C 246.32524,606.18363 233.12646,596.0684 227.37217,584.34937 224.89332,579.30102 224.5,577.33599 224.5,570 c 0,-7.08368 0.41656,-9.3225 2.5,-13.4362 6.73737,-13.30278 23.24703,-22.94128 41.5,-24.22808 14.94881,-1.05387 26.7378,2.93477 35.10131,11.87605 6.3932,6.83484 8.67563,12.49795 9.18443,22.78823 0.49608,10.03283 -1.75821,18.10646 -7.44983,26.68124 -9.29787,14.00785 -27.02074,20.25395 -45.06376,15.8819 z m -9.53458,-22.09188 c 5.10022,-3.57233 3.72534,-14.29551 -2.48975,-19.41852 -4.39525,-3.62293 -8.35432,-3.92817 -11.20886,-0.86418 -4.24439,4.55581 -1.24681,15.88478 5.25138,19.84693 3.87035,2.35988 5.57466,2.4478 8.44723,0.43577 z M 1242,340.06487 c -4.7994,-1.46521 -10.8265,-5.02879 -12.8448,-7.59472 -6.005,-7.63412 -6.3248,-15.80891 -1.0328,-26.39924 5.4784,-10.96318 17.2595,-20.4629 31.8894,-25.71402 18.6506,-6.69431 41.1275,-1.50724 48.581,11.21124 7.5774,12.92982 -1.8864,30.56678 -21.6175,40.2869 -14.6681,7.22596 -35.6515,11.05629 -44.9753,8.20984 z m 40.2978,-46.07509 c 6.6671,-2.49448 10.6124,-6.3155 9.0706,-8.78472 -2.9034,-4.64957 -11.9521,-5.25221 -20.7078,-1.37912 -7.659,3.38793 -8.3685,9.0441 -1.3875,11.06126 4.9638,1.43431 7.2054,1.27986 13.0247,-0.89742 z m -833.55188,-6.02123 c -9.79846,-2.45084 -20.58326,-10.42925 -25.56295,-18.91103 -5.42415,-9.23881 -2.91882,-20.94927 5.61744,-26.25711 5.55688,-3.45527 16.62374,-3.27317 24.46784,0.40262 6.5497,3.06923 15.54363,11.52081 18.48713,17.37234 5.24004,10.41692 2.77585,21.51296 -5.75755,25.92575 -3.68399,1.90507 -12.50313,2.65521 -17.25191,1.46743 z M 318.25067,239.45486 c -11.65837,-3.13933 -21.43366,-9.9417 -28.2646,-19.66861 C 282.95692,209.7771 280.5,201.91945 280.5,189.44814 c 0,-9.6105 0.16564,-10.38702 3.77234,-17.68468 7.95359,-16.09299 24.45569,-24.62349 45.50646,-23.52384 8.17492,0.42704 10.1805,0.93034 16.85801,4.23054 17.92229,8.85768 28.65227,26.8069 28.71207,48.02984 0.0419,14.88149 -5.58753,25.83935 -17.0375,33.16381 -10.16771,6.5042 -27.89544,9.06687 -40.06071,5.79105 z m -16.47383,-35.71732 c 5.44057,-5.79122 8.74814,-20.58678 6.27645,-28.07608 -2.84649,-8.62493 -8.91924,-7.70793 -13.72165,2.072 -2.43796,4.96482 -2.83164,6.95441 -2.83164,14.31052 0,6.49531 0.42514,9.19282 1.77305,11.25 2.19019,3.34265 5.61254,3.52116 8.50379,0.44356 z m 228.21615,-52.76333 c -29.3957,-3.44197 -64.95454,-35.59675 -75.0103,-67.829545 -6.71333,-21.518946 2.88363,-45.501491 21.79254,-54.459013 6.54022,-3.098228 7.09525,-3.184842 20.22477,-3.156135 12.27786,0.02684 14.11679,0.273895 20.31322,2.728982 12.91645,5.117624 25.86592,15.69768 34.14113,27.894193 5.06912,7.471176 11.82618,21.240192 14.97362,30.51208 14.13525,41.640288 -1.05518,68.452088 -36.43498,64.309438 z M 491.82822,63.978553 c 5.301,-2.280428 11.49306,-7.98974 12.993,-11.98002 1.29184,-3.436691 -0.6257,-8.795545 -4.05778,-11.340087 -6.81031,-5.049151 -21.86164,-2.296191 -30.3812,5.556868 -8.52415,7.857285 -7.60963,16.576184 2.09743,19.996572 3.44787,1.214894 14.22446,-0.02901 19.34855,-2.233333 z" />
              <path fill="#0088aa" className="group-hover:[fill:currentColor]" d="M 54,483.50701 C 37.383879,479.7539 21.947921,467.73176 14.830195,453 10.097028,443.20363 8.5939772,436.49677 8.6672648,425.5 8.7812341,408.39897 13.857268,396.21209 25.999771,383.88697 c 11.008593,-11.17416 23.932634,-16.72862 39.819547,-17.11352 30.366779,-0.73571 54.470272,19.98513 58.227822,50.0562 0.45843,3.66869 0.57419,8.58285 0.25726,10.92035 L 123.72815,432 H 92.409389 61.090626 l -0.675061,-3.59839 c -0.706415,-3.76551 -0.0222,-13.61103 1.068546,-15.3759 C 61.8525,412.42964 66.536908,412 72.667425,412 h 10.549391 l -0.66024,-2.63061 c -1.733188,-6.90557 -7.715008,-10.89689 -15.246637,-10.17319 -8.351688,0.80249 -13.541425,6.32817 -16.02727,17.06474 -3.14494,13.58327 2.083749,28.38333 11.435212,32.36794 4.922284,2.09736 7.626015,1.6774 13.154957,-2.04331 l 5.073817,-3.41442 10.276673,12.52082 c 13.385122,16.30808 12.496362,14.8553 10.462642,17.10253 -2.315845,2.55899 -10.280192,6.82201 -17.393262,9.30998 C 76.598769,484.79562 62.578863,485.44473 54,483.50701 Z m 218.48991,0.47653 C 250.84388,479.67962 234.67775,464.98665 227.39723,443 c -1.37339,-4.14755 -1.80708,-8.4508 -1.76366,-17.5 0.0499,-10.39295 0.41647,-13.00441 2.73755,-19.5 7.38725,-20.67341 25.20404,-35.71371 45.62888,-38.51826 20.50235,-2.81519 37.35805,2.47015 50.42239,15.81063 3.89268,3.97497 8.28276,9.47427 9.75572,12.22067 C 338.33472,403.2632 341,414.28742 341,423.7299 V 432 h -31.44098 c -23.90654,0 -31.62428,-0.29658 -32.20589,-1.23763 -1.21538,-1.96653 -0.85551,-14.03663 0.49231,-16.51237 1.14978,-2.11196 1.86695,-2.25 11.68974,-2.25 5.75565,0 10.46482,-0.23945 10.46482,-0.53212 0,-1.83878 -3.15414,-7.34776 -5.38482,-9.40506 -1.99305,-1.83814 -4.0525,-2.53627 -8.37888,-2.84031 -5.11746,-0.35964 -6.17727,-0.0818 -9.82378,2.57573 -6.57937,4.79487 -8.8589,10.65159 -8.83592,22.70176 0.0197,10.35544 0.7975,13.0291 5.73139,19.70266 2.62735,3.55374 9.11727,6.12774 13.41653,5.3212 1.82503,-0.34238 4.91014,-2.02022 6.8558,-3.72853 3.00056,-2.63452 3.73275,-2.89269 4.8234,-1.70067 0.70721,0.77294 5.95648,7.19483 11.66504,14.27087 l 10.37922,12.86553 -2.97399,2.37961 c -10.761,8.61031 -30.71155,13.2107 -44.98408,10.37287 z m 470.72562,-0.93238 c -21.55692,-5.85447 -36.77162,-21.36613 -41.94559,-42.7643 -1.38745,-5.7381 -1.69722,-14.93825 -2.00462,-59.53686 L 698.90174,328 h 21.02308 21.02309 l 0.27604,51.75 c 0.26381,49.45455 0.36476,51.92684 2.27605,55.7368 5.81054,11.58275 22.30869,11.31831 28.25,-0.45281 5.34901,-10.59762 -0.1974,-22.50627 -11.47489,-24.63766 -2.90324,-0.5487 -5.01103,-0.12647 -10.52511,2.10838 -1.63598,0.66305 -1.75,-0.76372 -1.75,-21.89772 V 368 h 8.36351 c 11.46546,0 17.65998,1.35506 27.08953,5.92586 19.61034,9.50575 32.51223,30.36885 32.51223,52.57414 0,25.28213 -16.3762,47.58961 -40.92572,55.74856 -8.5813,2.85197 -22.94419,3.2142 -31.82402,0.8026 z M 878,484.29542 C 857.28985,480.71488 840.52129,467.05681 832.82476,447.5 c -2.91531,-7.40779 -3.15339,-8.92533 -3.21612,-20.5 -0.10105,-18.64582 4.18091,-30.36512 15.31735,-41.92205 14.43447,-14.9795 32.9857,-20.94661 54.02158,-17.37636 11.42359,1.93883 20.71106,6.85134 29.30071,15.4983 11.30851,11.38397 16.70561,24.62124 16.73694,41.05011 L 945,432 h -31.53138 c -36.12432,0 -33.01861,0.96178 -32.89371,-10.18657 C 880.68099,412.3449 881.13627,412 893.52884,412 h 10.28396 l -1.06273,-3.46268 c -1.72808,-5.63062 -5.82892,-8.79639 -12.06437,-9.31348 -6.65266,-0.55169 -10.60966,1.30805 -14.6497,6.88516 -3.66315,5.05684 -5.45025,13.3926 -4.72583,22.04326 1.55993,18.6278 15.55963,27.46129 26.94157,16.99951 2.47041,-2.2707 2.87935,-2.36607 4,-0.93288 0.68654,0.87802 5.93229,7.31957 11.65722,14.31455 l 10.40896,12.71815 -2.40896,1.85272 c -4.74912,3.65253 -15.52672,8.69534 -21.97285,10.28103 -6.10978,1.50295 -16.10767,1.91774 -21.93611,0.91008 z M 168.51003,473.25 c -2.62766,-5.9125 -12.30591,-27.87747 -21.50722,-48.81105 -9.20131,-20.93358 -17.42923,-39.60858 -18.28426,-41.5 C 126.20385,377.37621 123,369.77573 123,369.37288 123,369.1678 131.71778,369 142.37285,369 h 19.37284 l 5.87716,14.6168 c 3.23243,8.03924 6.31826,14.60808 6.85739,14.59741 0.53914,-0.0107 3.71143,-6.47572 7.04955,-14.3668 L 187.5991,369.5 l 18.8145,-0.27248 18.8145,-0.27249 -0.61742,2.45999 c -0.33957,1.35299 -1.9232,5.30061 -3.51917,8.77248 -2.87803,6.26089 -38.97184,87.02435 -43.82488,98.0625 -1.39043,3.1625 -2.85452,5.75 -3.25354,5.75 -0.39901,0 -2.87539,-4.8375 -5.50306,-10.75 z M 530.5,482.83916 c -10.05963,-0.97096 -18.12956,-3.84527 -26.72172,-9.51762 -11.13987,-7.35429 -17.42133,-15.97765 -21.67587,-29.75722 L 479.6125,435.5 479.23019,381.75 478.84789,328 H 499.92395 521 v 21.5 21.5 h 9 9 v 22 22 h -9.13437 -9.13436 l 0.49023,6.85172 c 0.76444,10.68394 4.63895,15.37593 14.01805,16.97569 l 4.26045,0.72669 0.27041,21.40254 c 0.14873,11.7714 -0.0763,21.68427 -0.5,22.02861 -0.42373,0.34434 -4.37041,0.2786 -8.77041,-0.14609 z M 359.0082,451.25 c 0.0102,-38.39447 0.79348,-46.26406 5.57807,-56.04624 4.75116,-9.71383 13.45891,-18.96685 21.63879,-22.99379 25.37561,-12.49237 54.82293,-3.16222 66.30079,21.00689 5.1787,10.90486 6.43056,22.35419 6.45463,59.03314 L 459,482 h -21 -21 v -34.44424 -34.44423 l -2.37197,-2.75758 c -1.81217,-2.10677 -3.21223,-2.73377 -5.93224,-2.65667 C 400.28698,407.93564 400,409.29765 400,448.96788 V 482 H 379.5 359 Z M 561,446.94741 c 0,-39.49849 0.58818,-44.39302 6.75905,-56.24566 9.24662,-17.76034 27.91775,-26.5489 49.49095,-23.29553 l 4.75,0.71633 v 22.05535 22.05536 l -2.25,-0.65555 c -5.81438,-1.69405 -8.33208,-1.62196 -11.44739,0.32779 C 602.71348,415.40351 602,420.07614 602,453.1815 V 482 H 581.5 561 Z M 635,425.5 V 369 H 655.5 676 V 425.5 482 H 655.5 635 Z m 13.55782,-67.93492 c -5.84016,-2.1652 -8.79696,-4.67164 -11.30782,-9.58551 -6.73156,-13.17395 3.81522,-29.03633 19.25,-28.95203 6.56895,0.0359 16.00674,6.83709 18.43867,13.28756 2.49515,6.61818 0.31646,16.5146 -4.58226,20.81431 -5.6596,4.96755 -15.15328,6.89936 -21.79859,4.43567 z"/>
            </svg>
            </Link>

            {/*search Bar */}
            <div className="relative flex-grow mx-6 max-xl:max-w-sm max-w-lg">
                <form onSubmit={handleSearchSubmit} className="group flex items-center">
                <div className="group w-full flex flex-row rounded-full border-[0.1px] border-gray-300 transition duration-300 hover:border-[#ff952aff] focus-within:border-[#ff952aff] overflow-hidden">
                    <input
                    type="text"
                    name="search"
                    placeholder="Rechercher un événement..."
                    className="w-full px-4 py-2 border-none border-transparent outline-none text-sm bg-transparent"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    />
                    {searchQuery && (
                    <button
                        type="button"
                        onClick={handleClearSearch}
                        className="p-1 flex items-center justify-center text-gray-500 hover:text-gray-700 dark:text-gray-400 transition-colors cursor-pointer"
                        title="Effacer la recherche"
                    >
                        <XCircleIcon className="w-5 h-5 animate-pulse" /> 
                    </button>
                    )}
                </div>
                <button type="submit" className="ml-2 p-2 rounded-full bg-[#ff952aff] text-white hover:bg-[#111827] dark:hover:bg-gray-400 transition-colors duration-300  cursor-pointer" title="Rechercher">
                    <MagnifyingGlassIcon className="w-5 h-5" /> 
                </button>
                </form>
            </div>

            <nav className="flex flex-row gap-6 items-center">
                <ul className={`mobile-menu flex items-start min-[1025px]:items-center gap-3 min-[1025px]:gap-6 text-base xl:text-lg font-medium max-[1025px]:flex-col max-[1025px]:absolute max-[1025px]:top-full max-[1025px]:left-0 max-[1025px]:w-full bg-[#f5f5dc] dark:bg-[#222222] max-[1025px]:shadow-lg max-[1025px]:py-4 max-[1025px]:px-5 ${isMobileMenuOpen ? 'flex' : 'hidden'} min-[1025px]:flex rounded-b-2xl`}>
                <li>
                    <Link href="/events" 
                        className={`inline-flex whitespace-nowrap items-center gap-1 transition-colors duration-300  hover:text-[#ff952aff] rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] ${ 
                        pathname === '/events' ? ' shadow-[inset_0px_2px_1px_#ff952aff]' : '' }`}
                        onClick={() => setIsMobileMenuOpen(false)}
                    >
                        < HomeIcon  className="inline-block w-6 h-6 -translate-y-0.5"/>
                        <span>Accueil</span>
                    </Link>
                </li>
                {status === 'loading' ? (
                    <li>Chargement...</li>
                ) : session ? (
                    <>
                    <li>
                        <Link href="/my-events" 
                            className={`inline-flex whitespace-nowrap items-center gap-1 transition-colors duration-300  hover:text-[#ff952aff] rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] ${ 
                            pathname === '/my-events' ? ' shadow-[inset_0px_2px_1px_#ff952aff]' : '' }`}
                            onClick={() => setIsMobileMenuOpen(false)}
                        >
                            <CalendarDateRangeIcon className="inline-block w-6 h-6 -translate-y-0.5" />
                            <span>Mes Inscriptions</span>
                        </Link>
                    </li>
                    <li>
                        <Link href="/account" 
                            className={`inline-flex whitespace-nowrap items-center gap-1 transition-colors duration-300  hover:text-[#ff952aff] rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] ${ 
                            pathname === '/account' ? ' shadow-[inset_0px_2px_1px_#ff952aff]' : '' }`}
                            onClick={() => setIsMobileMenuOpen(false)}
                        >
                            <UserCircleIcon className="inline-block h-6 w-6" />
                            <span>Compte</span>
                        </Link>
                    </li>
                    {session.user.isAdmin && (
                        <li>
                        <Link href="/admin" className="inline-flex items-center gap-1 whitespace-nowrap transition-colors duration-300 hover:text-[#ff952aff] rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] group" 
                            title="Aller à l'administration"
                            onClick={() => setIsMobileMenuOpen(false)}
                        >
                            {/* admin icon */}
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 animate-bounce group-hover:animate-none" fill="currentColor" viewBox="0 0 512 512">
                                <path d="m 339.66627,489.43987 c -9.85888,-1.4084 -11.80445,-2.78386 -20.95508,-14.81454 -10.59888,-13.93475 -15.7884,-17.19367 -30.19726,-18.96329 -17.3944,-2.13629 -19.40268,-2.75448 -23.43001,-7.21226 -9.47142,-10.48373 -22.47711,-34.88809 -22.47711,-42.17688 0,-1.81593 2.25,-8.86568 5,-15.6661 4.37767,-10.82546 5,-13.25253 5,-19.5 0,-6.24747 -0.62233,-8.67454 -5,-19.5 -2.75,-6.80042 -5,-13.82178 -5,-15.60302 0,-3.97092 5.53696,-17.33488 10.88451,-26.27076 5.19518,-8.68128 13.06133,-18.32075 16.17345,-19.81954 1.36281,-0.65633 8.31884,-1.94653 15.45785,-2.86711 18.16422,-2.3423 22.2006,-4.72311 33.93541,-20.01644 5.98101,-7.79472 9.56946,-11.58329 11.66256,-12.31295 9.36674,-3.26526 35.06297,-3.84091 46.88622,-1.05034 5.51883,1.30257 7.24573,2.86986 16.67452,15.13333 10.17778,13.23764 14.80083,15.80787 32.74345,18.20404 7.10489,0.94884 14.20932,2.39293 15.78762,3.20911 6.7781,3.5051 25.1481,34.15596 26.4967,44.21059 0.4005,2.98621 -0.5661,6.41942 -4.5976,16.32962 -4.6317,11.38586 -5.1047,13.27155 -5.1047,20.35347 0,7.08192 0.473,8.96761 5.1047,20.35347 4.1863,10.2906 5.007,13.27695 4.5617,16.5973 -1.3099,9.76593 -19.7776,40.49595 -26.3788,43.89388 -1.5332,0.78921 -8.62363,2.21843 -15.75656,3.17605 -18.19497,2.44272 -22.03374,4.66387 -34.03103,19.69074 -4.95,6.19998 -10.12848,11.81107 -11.50773,12.46908 -6.08654,2.90375 -28.58862,4.05886 -41.93281,2.15255 z m 28.60127,-23.68275 c 1.18841,-0.35768 5.78965,-5.24793 10.22498,-10.86723 5.70113,-7.22299 9.31698,-10.84834 12.33927,-12.3717 2.35126,-1.18514 6.75002,-3.62209 9.77502,-5.41545 4.6492,-2.75625 7.416,-3.51972 17.88595,-4.9354 14.03817,-1.89816 13.33581,-1.43752 20.09166,-13.17716 7.02898,-12.21424 6.97688,-11.45815 1.67546,-24.33307 l -4.65307,-11.30028 v -12.3277 -12.3277 l 4.62592,-11.29453 c 5.26457,-12.85372 5.31727,-12.07933 -1.64831,-24.18348 -6.77875,-11.77943 -6.0295,-11.29274 -20.60584,-13.38511 -11.51507,-1.65295 -13.5724,-2.26318 -19.51909,-5.7896 -3.65602,-2.16805 -8.00114,-4.68416 -9.65581,-5.59134 -1.65467,-0.90719 -6.46218,-6.1457 -10.68334,-11.64114 -8.63531,-11.2421 -8.57116,-11.20943 -22.01353,-11.20943 -13.5463,0 -13.50194,-0.0226 -22.15395,11.26486 -4.22437,5.51111 -9.00159,10.74357 -10.61604,11.62767 -1.61446,0.88411 -5.90642,3.36547 -9.53769,5.51415 -5.88398,3.48162 -8.01882,4.11307 -19.62148,5.80369 -7.16055,1.04335 -13.2558,2.23197 -13.54501,2.64137 -5.31908,7.52956 -7.26472,10.65067 -9.89288,15.86974 -1.72312,3.42182 -3.13295,6.84285 -3.13295,7.60229 0,0.75943 2.025,6.21416 4.5,12.1216 l 4.5,10.74081 v 12.25919 12.25919 l -4.5,10.74081 c -2.475,5.90745 -4.5,11.38675 -4.5,12.17624 0,0.78948 1.40983,4.23509 3.13295,7.65691 2.62632,5.21542 4.59873,8.37948 9.89072,15.86624 0.28802,0.40746 6.13802,1.48865 13,2.40264 11.3198,1.50775 13.14023,2.04607 19.63825,5.8072 3.93906,2.27997 8.48108,4.87152 10.09338,5.759 1.61229,0.88748 6.42516,6.15 10.69524,11.69449 4.59448,5.9657 8.63854,10.25207 9.90663,10.50022 3.44233,0.67362 21.94001,0.55337 24.30356,-0.15799 z m -23.66073,-47.6758 c -18.33669,-5.09506 -32.18281,-19.47305 -35.89492,-37.27374 -5.37198,-25.76034 11.7425,-51.68382 37.69414,-57.0957 23.41959,-4.88385 47.00862,8.59039 55.40224,31.64619 2.94422,8.08726 2.94422,23.4102 0,31.49746 -5.21691,14.32994 -15.94626,24.99136 -30.09531,29.90477 -7.66071,2.66027 -20.10386,3.26668 -27.10615,1.32102 z m 22.57239,-25.272 c 8.59762,-4.4204 12.87483,-11.63031 12.87483,-21.70252 0,-7.55488 -1.56104,-11.72045 -6.31138,-16.84158 -4.64283,-5.00524 -9.84435,-7.09902 -17.63584,-7.09902 -7.79149,0 -12.99301,2.09378 -17.63584,7.09902 -4.75034,5.12113 -6.31138,9.2867 -6.31138,16.84158 0,11.72002 6.02513,19.88164 17.44075,23.62517 3.97084,1.30217 13.28885,0.28302 17.57886,-1.92265 z M 45.369377,417.04141 c -6.00539,-3.25849 -7.09849,-11.6043 -4.28675,-32.72932 C 54.907387,280.44454 156.50867,212.7909 258.10681,239.80135 c 16.16658,4.29797 20,7.28581 20,15.58831 0,3.79084 -0.50922,4.83749 -3.83759,7.88771 -4.60186,4.21728 -6.13704,4.18776 -23.69178,-0.45562 -41.88441,-11.0788 -84.7665,-3.82986 -121.42741,20.52651 -12.71952,8.45045 -30.821383,26.34436 -39.208983,38.75854 -16.09634,23.82363 -24.39885,48.41642 -26.22805,77.68991 l -0.75617,12.10121 -3.66032,3.35444 c -4.12269,3.77816 -9.08612,4.41575 -13.92713,1.78905 z M 194.94095,220.12608 c -25.78346,-4.67832 -49.68996,-19.74441 -64.69406,-40.77077 -6.01064,-8.42316 -13.10715,-23.33969 -15.81791,-33.24851 -1.84578,-6.74698 -2.19903,-10.74097 -2.25537,-25.5 -0.0793,-20.765911 1.51332,-28.317381 9.38492,-44.499997 13.41797,-27.58496 36.94508,-46.57733 67.68307,-54.637478 12.33931,-3.235624 33.75164,-3.261915 46.67219,-0.0573 12.31535,3.054504 22.63466,7.574528 32.76929,14.35347 35.29352,23.607447 52.21162,65.896905 42.93043,107.311395 -4.85884,21.68116 -19.35298,44.10651 -37.1984,57.55344 -22.88533,17.24461 -52.22058,24.44083 -79.47416,19.49576 z m 35.66586,-24.55889 c 16.288,-3.88152 32.48036,-14.05374 42.56304,-26.73856 5.82243,-7.32508 12.892,-21.74639 15.06038,-30.72183 2.29453,-9.49764 2.27508,-26.79508 -0.0405,-36 -4.11986,-16.377592 -15.18455,-33.49038 -27.84722,-43.068877 -7.49551,-5.669874 -19.84439,-11.745566 -28.7357,-14.138069 -8.93952,-2.405474 -29.06048,-2.405474 -38,0 -22.58487,6.077209 -42.53952,22.87127 -51.6692,43.485383 -9.14337,20.645013 -8.69393,45.747903 1.17958,65.883543 15.88818,32.40175 52.43344,49.6525 87.48962,41.29841 z"/>
                            </svg>
                            <span>Admin</span>
                        </Link>
                        </li>
                    )}
                    <li>
                        <button
                        onClick={handleSignOut}
                        className="inline-flex items-center gap-2 whitespace-nowrap transition-colors duration-300 hover:text-[#ff952aff] w-full text-left cursor-pointer rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] "
                        title="Se déconnecter">
                            <span>Hi {session.user.username} !</span>
                            <svg width="30" height="30" viewBox="0 0 448 417" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="swatch14">
                                        <stop style={{ stopColor: '#08263a', stopOpacity: 1 }} offset="0"/>
                                        <stop style={{ stopColor: '#4baae6', stopOpacity: 1 }} offset="1"/>
                                    </linearGradient>
                                    <linearGradient href="#swatch14" id="linearGradient14" x1="128.13605" y1="387.32764" x2="161.17738" y2="60.820076" gradientUnits="userSpaceOnUse" spreadMethod="reflect" />
                                </defs>
                                <g transform="translate(-3.9714294,-4.5387755)">
                                    <path style={{ fill: 'url(#linearGradient14)' }}
                                            d="M 188.08556,404.50827 C 173.77467,400.78055 153.8118,393.6119 139.5,387.06124 c -2.2,-1.00696 -6.925,-3.05955 -10.5,-4.5613 -8.29088,-3.48277 -28.22881,-13.73621 -39.059053,-20.08683 C 79.332662,356.19264 66.603994,344.12121 59.5722,333.61243 52.657556,323.27873 44.584492,307.51963 42.449513,300.18794 34.40446,272.56056 31.878417,170.14878 38.660956,117.81875 39.677846,101.445 44.442775,84.157812 52.264917,69.527943 57.090709,61.822601 69.47294,47.569548 71.414638,47.484904 72.011587,47.458881 74.3,46.63369 76.5,45.651147 92.44277,38.530935 118.71273,42.02308 156,56.219323 c 3.575,1.361096 11.19411,5.147028 13.71834,6.3481 15.318,7.036753 29.55215,14.744035 30.06359,16.278364 7.49087,5.203212 14.22862,12.595114 19.71526,20.182901 1.64845,2.459222 3.23508,4.696312 3.52583,4.971312 0.97818,0.92516 8.83997,17.45656 10.46249,22 5.69314,15.94218 7.35262,27.17524 8.49459,57.5 1.99149,52.88388 1.75977,115.66532 -0.5278,143 -0.73645,8.8 -1.603,20.85388 -1.92567,26.78641 -0.99532,18.29972 -6.27796,33.2571 -15.06263,42.64862 -9.66915,10.33711 -20.13657,12.80395 -36.37844,8.57324 z"/>
                                    <path fill="currentColor" d="m 240.39871,351.0472 c 0.31403,-4.15096 0.8563,-11.9347 1.20504,-17.2972 0.34875,-5.3625 0.99801,-9.75 1.44281,-9.75 3.45881,0 17.40518,-2.39774 21.45344,-3.68839 6.50762,-2.07475 14.70061,-7.51448 18.45235,-12.25144 6.38742,-8.06478 9.10707,-16.0551 10.57188,-31.06017 1.24999,-12.80458 3.82388,-18.0095 10.67611,-21.58928 4.02091,-2.10062 12.65521,-1.79617 16.5588,0.58388 7.29092,4.44533 8.36529,9.69968 5.82859,28.5054 -3.97289,29.45285 -20.42887,52.50569 -46.08773,64.56335 -9.81173,4.61075 -13.54769,5.62648 -28.73665,7.81293 l -11.93561,1.71813 z m 111.0698,-70.10936 c -3.51212,-1.02158 -9.28852,-6.33422 -10.57971,-9.73031 -1.31769,-3.46579 -1.07826,-9.83503 0.5071,-13.48965 0.76775,-1.76983 6.61775,-8.38554 13,-14.70157 C 360.77816,236.70028 366,231.18778 366,230.76631 366,230.34484 345.96055,230 321.46788,230 c -48.39312,0 -48.49471,-0.0107 -53.5584,-5.62684 -5.76082,-6.38935 -6.28512,-14.33761 -1.40985,-21.37263 C 271.43325,195.88131 270.51942,196 320.40113,196 344.93051,196 365,195.68533 365,195.30074 c 0,-0.38459 -5.16353,-5.92717 -11.4745,-12.31685 -15.02107,-15.20839 -17.21175,-20.58955 -12.22276,-30.02387 4.06211,-7.68156 13.24251,-10.84744 21.47938,-7.4072 4.43279,1.85142 45.79498,42.59684 50.22686,49.47791 4.27003,6.62977 6.25414,16.17861 4.89235,23.54519 -1.89716,10.2627 -4.43648,13.60668 -28.58071,37.63748 -26.13467,26.01187 -28.38121,27.47928 -37.85211,24.72444 z M 303.83049,169.97321 c -4.0073,-2.11684 -7.37943,-6.21373 -8.25909,-10.0342 C 295.26253,158.59755 294.32411,147.6 293.48602,135.5 291.39188,105.26564 289.64084,94.04717 285.79724,86.239693 281.68267,77.881826 272.25145,68.993708 264.31703,65.996448 251.81949,61.27545 218.92822,58.056557 182.81822,58.020596 c -20.65159,-0.02057 -20.69392,-0.02512 -29,-3.121607 C 128.14755,45.329026 113.32549,41.859904 97.596838,41.740307 86.340236,41.654714 78.690533,43.23456 73.25,46.768511 72.0125,47.572341 71,48.018466 71,47.759901 71,46.596052 83.702026,38.549778 90.255008,35.562549 106.98661,27.935315 138.20927,23.951828 181.5,23.921221 c 44.36534,-0.03137 78.45884,4.221795 94.23601,11.755935 22.1114,10.558954 39.66859,31.272343 45.62159,53.822844 3.79442,14.3736 8.60233,66.06136 6.68524,71.8702 -1.12719,3.41542 -4.92735,7.55545 -8.7271,9.50761 -3.37606,1.73449 -11.37373,1.26729 -15.48525,-0.9046 z"/>
                                </g>
                            </svg>
                        </button>
                    </li>
                    </>
                ) : (
                    <>
                    <li>
                        <Link href="/login" 
                            className={`inline-flex whitespace-nowrap items-center gap-1 transition-colors duration-300  hover:text-[#ff952aff] rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] ${ 
                            pathname === '/login' ? ' shadow-[inset_0px_2px_1px_#ff952aff]' : '' }`}
                            onClick={() => setIsMobileMenuOpen(false)}
                        >
                            <FingerPrintIcon  className="inline-block h-6 w-6"/>
                            <span>Connexion</span>
                        </Link>
                    </li>
                    <li>
                        <Link href="/register" 
                            className={`inline-flex whitespace-nowrap items-center gap-1 transition-colors duration-300  hover:text-[#ff952aff] rounded-full p-2 hover:shadow-[inset_0px_2px_1px_gray] ${ 
                            pathname === '/register' ? ' shadow-[inset_0px_2px_1px_#ff952aff]' : '' }`}
                            onClick={() => setIsMobileMenuOpen(false)}
                        >
                            <FingerPrintIcon  className="inline-block h-6 w-6"/>
                            <span>Inscription</span>
                        </Link>
                    </li>
                    </>
                )}
                </ul>
                <button
                id="burgerBtn"
                className="flex min-[1025px]:hidden cursor-pointer"
                title="Menu"
                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                >
                {isMobileMenuOpen ? <XMarkIcon className="w-8 h-8" /> : <Bars3Icon className="w-8 h-8" />}
                </button>
            </nav>
        </header>
    );
}